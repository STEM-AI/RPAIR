"use strict";(self.webpackChunkforntend=self.webpackChunkforntend||[]).push([[8466],{8466:(e,s,t)=>{t.r(s),t.d(s,{default:()=>x});var a=t(2791),n=t(2202),l=t(5804),r=t(6540),i=t(2903),o=t(1830),c=t.n(o),d=t(184);const m=e=>{let{onCalculate:s,onClose:t,gameId:o}=e;const[m,x]=(0,a.useState)(0),[u,h]=(0,a.useState)(0),[g,b]=(0,a.useState)(0),[p,j]=(0,a.useState)(60),[f,v]=(0,a.useState)(!1),[N,y]=(0,a.useState)(!1),[w,S]=(0,a.useState)(!1),_=(0,a.useRef)(null),C=localStorage.getItem("selected_event_name"),[k,T]=(0,a.useState)(!1),E=localStorage.getItem("access_token"),R=(0,a.useMemo)((()=>1*u+1*m+g*(e=>{switch(e){case 4:return 12;case 3:return 10;case 2:return 8;case 1:return 4;default:return 1}})(m)),[m,u,g]);(0,a.useEffect)((()=>(_.current=new WebSocket(`wss://rpair.org/ws/competition_event/${C}/game/${o}/`),_.current.onopen=()=>{console.log("WebSocket connection established")},_.current.onmessage=e=>{const s=JSON.parse(e.data);"paused"!==s.status?"resume"!==s.status?void 0!==s.remaining_time&&(j(Math.round(s.remaining_time)),s.remaining_time<=0&&(v(!1),S(!0))):y(!1):y(!0)},()=>{_.current&&(_.current.close(),console.log("WebSocket connection closed"))})),[C,o]);return(0,d.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4",children:(0,d.jsxs)("div",{className:"bg-white rounded-lg shadow-2xl w-full max-w-md overflow-hidden",children:[(0,d.jsxs)("div",{className:"flex justify-between items-center p-4 border-b border-gray-200",children:[(0,d.jsx)("h2",{className:"text-xl font-bold text-gray-800",children:"Game Score"}),(0,d.jsx)("button",{onClick:t,className:"text-gray-500 hover:text-red-600 transition-colors",children:(0,d.jsx)(n.aHS,{size:24})})]}),(0,d.jsx)("div",{className:"p-4 bg-gray-50",children:(0,d.jsxs)("div",{className:"text-center text-2xl font-bold text-gray-800",children:["Current Score: ",(0,d.jsx)("span",{className:"text-green-600",children:R})]})}),(0,d.jsxs)("div",{className:"p-4",children:[(0,d.jsxs)("div",{className:"flex justify-center space-x-4 mb-4",children:[!k&&(0,d.jsx)("button",{onClick:()=>{v(!0),y(!1),T(!0),S(!1),_.current&&_.current.send(JSON.stringify({action:"start_game",event_name:C,game_id:o}))},disabled:f,className:"bg-blue-500 text-white p-3 rounded-full shadow-md hover:bg-blue-600 transition-transform transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed",children:(0,d.jsx)(n.gmG,{size:18})}),k&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("button",{onClick:()=>{f&&!N&&(_.current&&_.current.send(JSON.stringify({action:"pause_game",event_name:C,game_id:o})),y(!0))},disabled:!f||N,className:"bg-yellow-500 text-white p-3 rounded-full shadow-md hover:bg-yellow-600 transition-transform transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed",children:(0,d.jsx)(n.Wh,{size:18})}),(0,d.jsx)("button",{onClick:()=>{f&&N&&(_.current&&_.current.send(JSON.stringify({action:"resume_game",event_name:C,game_id:o})),y(!1))},disabled:!N,className:"bg-green-500 text-white p-3 rounded-full shadow-md hover:bg-green-600 transition-transform transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed",children:(0,d.jsx)(l.zPJ,{size:18})}),(0,d.jsx)("button",{onClick:()=>{_.current&&_.current.send(JSON.stringify({action:"restart_game",event_name:C,game_id:o})),j(60),y(!1),S(!1)},disabled:!f,className:"bg-red-500 text-white p-3 rounded-full shadow-md hover:bg-red-600 transition-transform transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed",children:(0,d.jsx)(n.lbL,{size:18})})]})]}),(0,d.jsx)("div",{className:"text-center text-lg font-bold text-red-600 bg-gray-100 p-2 rounded-lg shadow-sm",children:N?"Game Paused":w?"Time's Up!":`Remaining Time: ${p} seconds`})]}),(0,d.jsx)("div",{className:"p-4",children:[{label:"Switch",count:m,setCount:x,icon:(0,d.jsx)(n.WLu,{size:20,className:"text-blue-500"}),max:4},{label:"Goal",count:u,setCount:h,icon:(0,d.jsx)(n.ULU,{size:20,className:"text-green-500"})},{label:"Pass",count:g,setCount:b,icon:(0,d.jsx)(r.kSj,{size:20,className:"text-orange-500"})}].map((e=>{let{label:s,count:t,setCount:a,icon:n,max:l}=e;return(0,d.jsxs)("div",{className:"flex items-center justify-between bg-gray-100 p-3 rounded-lg mb-3 shadow-md",children:[(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[n,(0,d.jsx)("span",{className:"font-semibold text-gray-700",children:s})]}),(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsx)("button",{onClick:()=>a(l?Math.min(l,t+1):t+1),disabled:!f,className:"bg-blue-500 text-white px-3 py-1 rounded-lg hover:bg-blue-600 transition-transform transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed",children:"+"}),(0,d.jsx)("span",{className:"text-xl font-bold",children:t}),(0,d.jsx)("button",{onClick:()=>a(Math.max(0,t-1)),disabled:!f,className:"bg-red-500 text-white px-3 py-1 rounded-lg hover:bg-red-600 transition-transform transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed",children:"-"})]})]},s)}))}),(0,d.jsx)("div",{className:"p-4 border-t border-gray-200",children:(0,d.jsx)("button",{onClick:async()=>{if(R)try{const e=await i.Z.post(`${{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_API_URL}/game/${o}/set-game-score/`,{event_name:C,score:R},{headers:{"Content-Type":"application/json",Authorization:`Bearer ${E}`}});if(200!==e.status&&201!==e.status)throw new Error("Failed to submit score");console.log("Score submitted successfully:",e.data),c().fire({icon:"success",title:"Success",text:"Score submitted successfully!",showConfirmButton:!0,confirmButtonColor:"#28a745"}),s(R),t()}catch(e){console.error("Error submitting score:",e),alert("Failed to submit score. Please try again.")}else alert("Please enter a valid score.")},disabled:f||!w,className:"w-full bg-green-500 text-white py-2 rounded-lg text-lg font-semibold shadow-md hover:bg-green-600 transition-transform transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed",children:w?"Calculate & Submit Score":"Submit Score (Time's Up)"})})]})})},x=()=>{const[e,s]=(0,a.useState)(null),[t,l]=(0,a.useState)({}),[r,o]=(0,a.useState)([]),[c,x]=(0,a.useState)({}),[u,h]=(0,a.useState)(!1),[g,b]=(0,a.useState)([]),[p,j]=(0,a.useState)(""),f=localStorage.getItem("selected_event_name"),v=localStorage.getItem("access_token"),N={stage:"teamwork",time:p};(0,a.useEffect)((()=>{y()}),[t]),(0,a.useEffect)((()=>{g.length>0&&y()}),[g]);const y=()=>{if(!g||0===g.length)return;const e={};g.forEach((s=>{var a;let{id:n,team1:l,team2:r}=s;const i=null!==(a=t[n])&&void 0!==a?a:0;e[l]=(e[l]||0)+i,e[r]=(e[r]||0)+i}));const s=Object.entries(e).map((e=>{let[s,t]=e;return{name:s,total:t}})).sort(((e,s)=>s.total-e.total));o(s),console.log("Updated Rankings:",s)},w=e=>{let{children:s,className:t}=e;return(0,d.jsx)("th",{className:`px-2.5 py-2 sm:px-4 sm:py-3 text-xs sm:text-sm font-medium text-gray-500 uppercase tracking-wider text-center ${t}`,children:s})},S=e=>{let{children:s,className:t}=e;return(0,d.jsx)("td",{className:`px-2.5 py-2 sm:px-4 sm:py-3 text-sm text-gray-900 text-center ${t}`,children:s})};return(0,d.jsxs)("div",{className:"max-w-full mx-auto px-2 sm:px-4 lg:px-8 py-4",children:[(0,d.jsx)("h1",{className:"text-xl sm:text-2xl md:text-3xl font-bold text-center text-gray-800 mb-4 sm:mb-6",children:"Teamwork Matches"}),(0,d.jsx)("div",{className:"flex justify-center mb-6",children:(0,d.jsxs)("form",{onSubmit:async e=>{e.preventDefault();try{const e=await i.Z.post(`${{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_API_URL}/event/${f}/games-schedule/`,N,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${v}`}});console.log("Schedule posted successfully"),console.log("Response Data:",e.data),b(e.data)}catch(s){console.error("Error posting schedule:",s)}},className:"flex gap-4 items-center",children:[(0,d.jsx)("input",{type:"time",value:p,onChange:e=>j(e.target.value),className:"px-4 py-2 rounded-md border border-indigo-300 focus:ring-2 focus:ring-indigo-200 text-lg"}),(0,d.jsx)("button",{type:"submit",className:"bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-6 rounded-md transition-all",children:"Set Schedule"})]})}),(0,d.jsx)("div",{className:"overflow-x-auto rounded-lg bg-white shadow-sm sm:shadow-lg",children:(0,d.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,d.jsx)("thead",{className:"bg-gray-50",children:(0,d.jsxs)("tr",{children:[(0,d.jsx)(w,{children:"Match"}),(0,d.jsx)(w,{children:"Team 1"}),(0,d.jsx)(w,{className:"hidden sm:table-cell",children:"Team1-Code"}),(0,d.jsx)(w,{children:"Team 2"}),(0,d.jsx)(w,{className:"hidden sm:table-cell",children:"Team2-Code"}),(0,d.jsx)(w,{children:"Score"}),(0,d.jsx)(w,{children:"Actions"})]})}),(0,d.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:g.map((e=>{var a,r;return(0,d.jsxs)("tr",{className:"hover:bg-gray-50/50",children:[(0,d.jsx)(S,{children:e.id}),(0,d.jsx)(S,{children:e.team1}),(0,d.jsx)(S,{className:"hidden sm:table-cell",children:e.team1_id}),(0,d.jsx)(S,{children:e.team2}),(0,d.jsx)(S,{className:"hidden sm:table-cell",children:e.team2_id}),(0,d.jsx)(S,{children:(0,d.jsxs)("div",{className:"flex items-center justify-center gap-1.5",children:[(0,d.jsx)("span",{className:"text-sm font-medium text-blue-600",children:null!==(a=null!==(r=c[e.id])&&void 0!==r?r:t[e.id])&&void 0!==a?a:0}),void 0!==c[e.id]&&(0,d.jsx)("button",{onClick:()=>{return s=e.id,void(void 0!==c[s]&&l((e=>({...e,[s]:c[s]}))));var s},className:"text-green-600 hover:text-green-800 p-1",children:(0,d.jsx)(n.l_A,{className:"text-sm"})})]})}),(0,d.jsx)(S,{children:(0,d.jsxs)("button",{onClick:()=>{return t=e.id,console.log("matchCode",t),void s(t);var t},className:"inline-flex items-center px-2.5 py-1 text-xs sm:text-sm font-medium text-white bg-green-500 rounded-md hover:bg-green-600 transition-colors whitespace-nowrap",children:[(0,d.jsx)("span",{className:"hidden xs:inline",children:"Calculator"}),(0,d.jsx)("span",{className:"xs:hidden",children:"Calc"})]})})]},e.id)}))})]})}),e&&(0,d.jsx)(m,{onCalculate:t=>{x((s=>({...s,[e]:t}))),s(null)},onClose:()=>s(null),gameId:e,mode:"manual"}),(0,d.jsx)("div",{className:"flex justify-center mt-4 sm:mt-6 mb-4",children:(0,d.jsxs)("button",{onClick:()=>h(!u),className:"inline-flex items-center px-4 py-2 text-sm font-medium text-white bg-yellow-500 rounded-lg hover:bg-yellow-600 gap-2",children:[(0,d.jsx)(n.yyP,{className:"shrink-0"}),(0,d.jsx)("span",{className:"hidden sm:inline",children:"View Ranking"}),(0,d.jsx)("span",{className:"sm:hidden",children:"Ranking"})]})}),u&&(0,d.jsxs)("div",{className:"overflow-x-auto shadow-sm sm:shadow-xl rounded-lg mt-4 bg-white p-3 sm:p-4 border border-gray-200",children:[(0,d.jsx)("h2",{className:"text-lg sm:text-xl font-bold text-center text-gray-800 mb-3 sm:mb-4",children:"\ud83c\udfc6 Team Rankings"}),(0,d.jsxs)("table",{className:"min-w-full border-collapse",children:[(0,d.jsx)("thead",{children:(0,d.jsxs)("tr",{className:"bg-gray-50",children:[(0,d.jsx)(w,{children:"Rank"}),(0,d.jsx)(w,{children:"Team"}),(0,d.jsx)(w,{children:"Score"})]})}),(0,d.jsx)("tbody",{children:r.map(((e,s)=>(0,d.jsxs)("tr",{className:"hover:bg-gray-50/50",children:[(0,d.jsx)(S,{children:s+1}),(0,d.jsx)(S,{children:e.name}),(0,d.jsx)(S,{className:"font-medium text-blue-600",children:e.total})]},e.name)))})]})]})]})}}}]);
//# sourceMappingURL=8466.52a26554.chunk.js.map