"use strict";(self.webpackChunkforntend=self.webpackChunkforntend||[]).push([[5812,951],{3791:(e,t,s)=>{s.d(t,{Z:()=>i});var a=s(2791),n=s(2903);const i=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"-id";const[i,r]=(0,a.useState)([]),[l,o]=(0,a.useState)(!0),[c,d]=(0,a.useState)(null),m=localStorage.getItem("access_token"),x=async()=>{try{const a=await n.Z.get(`https://rpair.org/api/core/event/${e}/schedule/`,{params:{ordering:s,stage:t},headers:{Authorization:`Bearer ${m}`}});r(a.data)}catch(a){d(a.message||"Failed to fetch schedules")}finally{o(!1)}};return(0,a.useEffect)((()=>{e&&x()}),[e,s,t]),{schedules:i,loading:l,error:c,refetch:x}}},5442:(e,t,s)=>{s.d(t,{Z:()=>i});var a=s(2791),n=s(2903);const i=e=>{const[t,s]=(0,a.useState)(null),[i,r]=(0,a.useState)(!0),[l,o]=(0,a.useState)(null),c=localStorage.getItem("access_token");return(0,a.useEffect)((()=>{e?(async()=>{try{const t=await n.Z.get(`https://rpair.org/api/core/event/schedule/${e}/`,{headers:{Authorization:`Bearer ${c}`}});s(t.data)}catch(t){o(t.message||"Failed to fetch schedule details")}finally{r(!1)}})():(o("Schedule ID is required"),r(!1))}),[e]),{schedule:t,loading:i,error:l}}},5812:(e,t,s)=>{s.r(t),s.d(t,{default:()=>h});var a=s(2791),n=s(2202),i=s(3859),r=(s(6457),s(2903)),l=s(8408),o=s(3791),c=s(5442),d=s(951),m=s(6083),x=s(184);const h=()=>{var e;const{currentCompetition:t}=(0,l.B)(),{matches:s,setCurrentMatch:h}=(0,i.a)(),[u,g]=(0,a.useState)(!1),[p,f]=(0,a.useState)({}),[b,j]=(0,a.useState)({}),[v,y]=(0,a.useState)([]),[N,w]=(0,a.useState)(null),S=localStorage.getItem("access_token"),[_,C]=(0,a.useState)(""),[k,$]=(0,a.useState)([]),[M,T]=(0,a.useState)(!1),[E,Z]=(0,a.useState)(null),F=t,{schedules:I,loading:O,error:A,refetch:D}=(0,o.Z)(F,"coop","-id"),R=null===(e=I[0])||void 0===e?void 0:e.id,{schedule:z,loading:P,error:J,refetch:B}=(0,c.Z)(R),G=e=>{const t=e%60;return`${Math.floor(e/60)}:${t<10?"0":""}${t}`};return(0,x.jsx)("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:N?(0,x.jsx)(d.default,{selectedMatch:N,eventName:F,onClose:()=>w(null)}):(0,x.jsxs)(x.Fragment,{children:[(0,x.jsxs)("div",{className:"mb-8 flex items-center justify-between",children:[(0,x.jsxs)("div",{className:"flex items-center gap-4",children:[(0,x.jsx)(m.Z,{className:"text-indigo-600 hover:text-indigo-700"}),(0,x.jsxs)("div",{children:[(0,x.jsxs)("h1",{className:"text-3xl font-bold text-indigo-700 flex items-center gap-3",children:[(0,x.jsx)(n.I$,{className:"w-8 h-8"}),(0,x.jsx)("span",{children:"COOP Matches"})]}),(0,x.jsxs)("p",{className:"mt-1 text-gray-600",children:["Manage cooperative matches for ",F]})]})]}),(0,x.jsxs)("button",{onClick:async()=>{try{await D(),await B()}catch(e){console.error("Error refreshing schedule:",e)}},className:"h-fit flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg transition-colors",children:[(0,x.jsx)(n.lbL,{className:"w-4 h-4"}),(0,x.jsx)("span",{className:"hidden sm:inline",children:"Refresh"})]})]}),(0,x.jsx)("div",{className:"bg-white rounded-xl shadow-lg overflow-hidden mb-8",children:(0,x.jsx)("div",{className:"overflow-x-auto",children:(0,x.jsxs)("table",{className:"w-full divide-y divide-gray-200",children:[(0,x.jsx)("thead",{className:"bg-indigo-600",children:(0,x.jsx)("tr",{children:["Match","Teams","Score","Time","Status"].map((e=>(0,x.jsx)("th",{className:"px-4 py-3 text-sm font-semibold text-white text-center uppercase tracking-wider",children:e},e)))})}),(0,x.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:((null===z||void 0===z?void 0:z.games)||[]).map((e=>{var t,a;return(0,x.jsxs)("tr",{className:b[e.id]?"bg-emerald-50/50":"hover:bg-gray-50",children:[(0,x.jsxs)("td",{className:"px-4 py-3 text-center font-medium text-indigo-600",children:["#",e.id]}),(0,x.jsx)("td",{className:"px-4 py-3 text-center",children:(0,x.jsxs)("div",{className:"flex flex-col space-y-1",children:[(0,x.jsx)("span",{className:"font-medium",children:e.team1_name}),(0,x.jsx)("span",{className:"text-xs text-gray-500",children:"and"}),(0,x.jsx)("span",{className:"font-medium",children:e.team2_name})]})}),(0,x.jsx)("td",{className:"px-4 py-3 text-center font-bold text-gray-700",children:(null===(t=s[e.id])||void 0===t?void 0:t.score)||0}),(0,x.jsx)("td",{className:"px-4 py-3 text-center text-gray-600 hidden sm:table-cell",children:null!==(a=s[e.id])&&void 0!==a&&a.totalTime?G(s[e.id].totalTime):"--:--"}),(0,x.jsx)("td",{className:"px-4 py-3 text-center",children:(0,x.jsx)("button",{onClick:()=>(e=>{h({...e,type:"coop",mode:"coop"}),w(e)})(e),disabled:b[e.id],className:"inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full text-sm transition-all "+(b[e.id]?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-indigo-600 hover:bg-indigo-700 text-white"),children:b[e.id]?(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(n.l_A,{className:"w-3.5 h-3.5"}),(0,x.jsx)("span",{children:"Completed"})]}):(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(n.gmG,{className:"w-3.5 h-3.5"}),(0,x.jsx)("span",{children:"Start"})]})})})]},e.id)}))})]})})}),(0,x.jsxs)("div",{className:"bg-white rounded-xl shadow-lg overflow-hidden",children:[(0,x.jsxs)("div",{className:"flex items-center justify-between px-6 py-4 bg-indigo-600",children:[(0,x.jsxs)("h2",{className:"text-xl font-bold text-white flex items-center gap-2",children:[(0,x.jsx)(n.NMh,{className:"w-6 h-6"}),"Team Rankings"]}),(0,x.jsxs)("button",{onClick:()=>{g((e=>{const t=!e;return t&&(async()=>{T(!0),Z(null);try{const e=await r.Z.get(`https://rpair.org/api/vex-go/${F}/coop/rank/`,{headers:{Authorization:`Bearer ${S}`}});$(e.data)}catch(E){console.error("Error fetching coop rankings:",E),Z(E.message)}finally{T(!1)}})(),t}))},className:"flex items-center gap-2 px-4 py-2 bg-white/10 hover:bg-white/20 text-white rounded-lg transition-colors",children:[(0,x.jsx)(n.yyP,{className:"w-4 h-4"}),u?"Hide":"Show"," Rankings"]})]}),u&&(0,x.jsx)("div",{className:"p-6",children:M?(0,x.jsx)("div",{className:"space-y-4",children:[...Array(5)].map(((e,t)=>(0,x.jsx)("div",{className:"h-12 bg-gray-100 animate-pulse rounded-lg"},t)))}):E?(0,x.jsxs)("div",{className:"text-center py-6 text-red-500",children:["\u26a0\ufe0f Error loading rankings: ",E]}):0===k.length?(0,x.jsx)("div",{className:"text-center py-6 text-gray-500",children:"\ud83c\udfdf\ufe0f No rankings available yet"}):(0,x.jsx)("div",{className:"grid gap-4",children:k.map(((e,t)=>{const s=t+1;return(0,x.jsxs)("div",{className:`group flex items-center justify-between p-4 rounded-lg transition-all ${s<=3?"border-2":"border hover:border-indigo-200 hover:bg-indigo-50/30"} ${1===s?"border-yellow-300 bg-yellow-50":2===s?"border-gray-300 bg-gray-50":3===s?"border-amber-400 bg-amber-50":"border-gray-200 bg-white"}`,children:[(0,x.jsxs)("div",{className:"flex items-center gap-4",children:[(0,x.jsx)("span",{className:"w-8 h-8 flex items-center justify-center rounded-full "+(s<=3?1===s?"bg-yellow-400 text-white":2===s?"bg-gray-400 text-white":"bg-amber-500 text-white":"bg-indigo-100 text-indigo-600 group-hover:bg-indigo-200"),children:s}),(0,x.jsx)("span",{className:"font-medium "+(s>3?"text-gray-600 group-hover:text-indigo-700":"text-gray-700"),children:e.team__name})]}),(0,x.jsxs)("div",{className:"flex items-center gap-4",children:[(0,x.jsx)("span",{className:"text-lg font-bold "+(s>3?"text-gray-700":"text-indigo-600"),children:e.avg_score||0}),s<=3?(0,x.jsxs)("span",{className:"text-2xl",children:[1===s&&"\ud83e\udd47",2===s&&"\ud83e\udd48",3===s&&"\ud83e\udd49"]}):(0,x.jsxs)("div",{className:"flex items-center gap-1 text-gray-400",children:[(0,x.jsx)("span",{className:"text-sm",children:"Rank"}),(0,x.jsx)("span",{className:"font-medium",children:s})]})]})]},e.team)}))})})]})]})})}},951:(e,t,s)=>{s.r(t),s.d(t,{default:()=>f});var a=s(2791),n=s(2202),i=s(2602),r=s(5125),l=(s(1052),s(763)),o=s(3859),c=(s(6083),s(2903)),d=s(1830),m=s.n(d),x=s(5804),h=s(6457),u=s(5995),g=s(184);const p=[{title:"Move purple sensor to the fish habitat",points:1},{title:"Move blue sensor to the pipeline",points:1},{title:"Move the orange sensor to the volcano tile",points:1},{title:"Orange sensor placed on top of the volcano",points:2},{title:"Align the turbines",points:"1 per turbine",isDynamic:!0},{title:"Open the clam",points:1},{title:"Remove the pearl from the clam",points:1},{title:"Deliver the pearl to the green starting tile",points:1},{title:"End with the robot on the green tile",points:1}];function f(e){let{eventName:t,onClose:s}=e;const{currentMatch:d,updateMatch:f}=(0,o.a)(),[b,j]=(0,a.useState)({}),[v,y]=(0,a.useState)({}),[N,w]=(0,a.useState)(0),[S,_]=(0,a.useState)(!1),[C,k]=(0,a.useState)(!1),[$,M]=(0,a.useState)(60),[T,E]=(0,a.useState)({matchId:"",team1_name:"",team2_name:""}),[Z,F]=((0,i.s0)(),(0,a.useState)([])),I=localStorage.getItem("access_token"),O=(0,a.useRef)(null),[A,D]=(0,a.useState)("disconnected"),[R,z]=((0,a.useRef)(null),(0,a.useState)(!1)),[P,J]=(0,a.useState)(!1),B=(0,a.useRef)($),[G]=(0,u.Z)("/sounds/start.mp3",{volume:1}),[W]=(0,u.Z)("/sounds/End.mp3",{volume:1}),[Y]=(0,u.Z)("/sounds/Middle.MP3",{volume:1});(0,a.useEffect)((()=>{"coop"===(null===d||void 0===d?void 0:d.type)&&E({matchId:d.id,team1:d.team1_name,team2:d.team2_name})}),[d]);const q=d.id;(0,a.useEffect)((()=>{if(t&&q)return O.current=new WebSocket(`wss://rpair.org/ws/competition_event/${t}/game/${q}/`),O.current.onopen=()=>{console.log("WebSocket connection established")},O.current.onmessage=e=>{const t=JSON.parse(e.data);"started"===t.status&&(_(!0),z(!1)),t.remaining_time<=0&&(_(!1),z(!0)),"paused"!==t.status?"resume"!==t.status?void 0!==t.remaining_time&&(M(Math.round(t.remaining_time)),t.remaining_time<=0&&(_(!1),z(!0))):k(!1):k(!0)},()=>{O.current&&O.current.close()};h.Z.error({title:"Missing Data",text:"Event name or Game ID is missing. Please check the configuration."})}),[t,q]);const L=e=>{let t=parseInt(e.target.value,10)||0;t>2&&(t=2),t<0&&(t=0),w(t),j((e=>({...e,4:t})));const s=60-$;t>0?(F((e=>e.some((e=>4===e.index))?e:[...e,{index:4,time:s}])),y((e=>({...e,4:s})))):(F((e=>e.filter((e=>4!==e.index)))),y((e=>{const t={...e};return delete t[4],t})))},H=e=>{const t=(0,l.sortBy)(Z,"time"),s=t.find((t=>t.index===e));if(!s)return"-";const a=t.indexOf(s);return K(0===a?s.time:s.time-t[a-1].time)},U=Object.values(b).reduce(((e,t)=>e+(parseInt(t)||0)),0),K=e=>{const t=Math.max(0,e),s=t%60;return`${Math.floor(t/60)}:${s<10?"0":""}${s}`};return(0,a.useEffect)((()=>{0===$&&W()}),[$,W]),(0,a.useEffect)((()=>{S&&!C&&B.current>=30&&30===$&&Y(),B.current=$}),[$,S,C,Y]),(0,g.jsxs)("div",{className:"max-w-5xl mx-auto mt-4 sm:mt-8 p-3 sm:p-6 bg-white shadow-md sm:shadow-xl rounded-lg sm:rounded-xl",children:[(0,g.jsxs)("div",{className:"text-center mb-4 sm:mb-8",children:[(0,g.jsx)("h1",{className:"text-xl sm:text-3xl font-bold text-indigo-700 mb-1 sm:mb-2",children:"\ud83c\udf0a Ocean Science Exploration"}),(0,g.jsx)("p",{className:"text-sm sm:text-lg text-gray-600",children:"Coop Match Score Sheet"})]}),(0,g.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2 sm:gap-4 mb-4 sm:mb-6 bg-indigo-50 p-2 sm:p-4 rounded-lg sm:rounded-xl",children:[(0,g.jsxs)("div",{children:[(0,g.jsx)("h3",{className:"text-xs sm:text-sm font-medium text-indigo-700 mb-1",children:"Match ID"}),(0,g.jsx)("p",{className:"text-base sm:text-xl font-bold",children:(null===d||void 0===d?void 0:d.id)||"N/A"})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("h3",{className:"text-xs sm:text-sm font-medium text-indigo-700 mb-1",children:"Team 1"}),(0,g.jsx)("p",{className:"text-base sm:text-xl font-bold",children:(null===d||void 0===d?void 0:d.team1_name)||"N/A"})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("h3",{className:"text-xs sm:text-sm font-medium text-indigo-700 mb-1",children:"Team 2"}),(0,g.jsx)("p",{className:"text-base sm:text-xl font-bold",children:(null===d||void 0===d?void 0:d.team2_name)||"N/A"})]})]}),(0,g.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-center bg-gray-100 p-2 sm:p-4 rounded-lg mb-4 sm:mb-6",children:[(0,g.jsxs)("div",{className:"flex items-center mb-2 sm:mb-0",children:[(0,g.jsx)(n.qyc,{className:"text-indigo-600 mr-2 text-lg sm:text-xl"}),(0,g.jsx)("span",{className:"text-lg sm:text-xl font-semibold",children:C?"Game Paused":R?"Time's Up!":`${$} seconds`})]}),(0,g.jsxs)("div",{className:"flex gap-1 sm:gap-2 w-full sm:w-auto",children:[!P&&(0,g.jsxs)("button",{onClick:()=>{G(),_(!0),k(!1),J(!0),z(!1),O.current&&O.current.send(JSON.stringify({action:"start_game",event_name:t,game_id:q}))},disabled:S,className:"flex-1 sm:flex-none px-3 py-1 sm:px-4 sm:py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg flex items-center justify-center text-sm sm:text-base",children:[(0,g.jsx)(n.gmG,{className:"mr-1 sm:mr-2"})," Start"]}),P&&(0,g.jsxs)(g.Fragment,{children:[(0,g.jsxs)("button",{onClick:()=>{S&&!C&&(O.current&&O.current.send(JSON.stringify({action:"pause_game",event_name:t,game_id:q})),k(!0))},disabled:!S||C,className:"flex-1 sm:flex-none px-3 py-1 sm:px-4 sm:py-2 bg-yellow-600 hover:bg-yellow-700 text-white rounded-lg flex items-center justify-center text-sm sm:text-base",children:[(0,g.jsx)(n.Wh,{className:"mr-1 sm:mr-2"}),"Pause"]}),(0,g.jsx)("button",{onClick:()=>{S&&C&&(O.current&&O.current.send(JSON.stringify({action:"resume_game",event_name:t,game_id:q})),k(!1))},disabled:!C,className:"flex-1 sm:flex-none px-3 py-1 sm:px-4 sm:py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg flex items-center justify-center text-sm sm:text-base",children:(0,g.jsx)(x.zPJ,{size:18})}),(0,g.jsxs)("button",{onClick:()=>{h.Z.confirm({title:"Restart Game?",html:"This will reset all counters and the timer!",confirmText:"Confirm Restart",cancelText:"Cancel",onConfirm:()=>{O.current&&O.current.send(JSON.stringify({action:"restart_game",event_name:t,game_id:q})),G(),M(60),_(!1),k(!1),z(!1),j({}),w(0),F([])},onCancel:()=>{m().fire("Cancelled","Game restart was cancelled","info")}})},disabled:!S,className:"flex-1 sm:flex-none px-3 py-1 sm:px-4 sm:py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg flex items-center justify-center text-sm sm:text-base",children:[(0,g.jsx)(n.WLu,{className:"mr-1 sm:mr-2"})," Restart"]})]})]})]}),(0,g.jsx)("table",{className:"w-full border-collapse rounded-lg overflow-hidden shadow-sm sm:shadow-md",children:(0,g.jsx)("tbody",{children:p.map(((e,t)=>(0,g.jsxs)("tr",{className:"border-b "+(t%2===0?"bg-white":"bg-indigo-50"),children:[(0,g.jsx)("td",{className:"px-4 py-2 text-sm",children:e.title}),(0,g.jsx)("td",{className:"px-4 py-2 text-center text-sm font-medium",children:e.points}),(0,g.jsx)("td",{className:"px-4 py-2 text-center text-sm hidden sm:table-cell",children:e.isDynamic?b[4]||0:b[t]||0}),(0,g.jsx)("td",{className:"px-4 py-2 text-center text-sm hidden sm:table-cell",children:H(t)}),(0,g.jsx)("td",{className:"px-4 py-2 text-center",children:e.isDynamic?(0,g.jsx)("input",{type:"number",min:"0",max:"2",value:N,onChange:L,className:"w-16 px-2 py-1 border rounded text-center focus:ring-2 focus:ring-indigo-400 text-sm",disabled:!S||C||R}):(0,g.jsx)("input",{type:"checkbox",checked:!!b[t],onChange:e=>((e,t)=>{const s=60-$;j((s=>({...s,[e]:t?p[e].points:0}))),t?(F((t=>[...t,{index:e,time:s}])),y((t=>({...t,[e]:s})))):(F((t=>t.filter((t=>t.index!==e)))),y((t=>{const s={...t};return delete s[e],s})))})(t,e.target.checked),className:"w-5 h-5 accent-green-500 cursor-pointer",disabled:!S||C||R})})]},t)))})}),(0,g.jsxs)("div",{className:"bg-indigo-50 p-4 rounded-xl mb-6 flex flex-col sm:flex-row justify-between items-center gap-3",children:[(0,g.jsxs)("div",{className:"text-center sm:text-left",children:[(0,g.jsx)("h3",{className:"text-sm font-medium text-indigo-700",children:"Total Score"}),(0,g.jsx)("p",{className:"text-3xl font-bold text-indigo-600",children:U})]}),(0,g.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3 w-full sm:w-auto",children:[(0,g.jsxs)("button",{onClick:async()=>{if(!d)return;const e=60-$;h.Z.confirm({title:"Submit Final Score?",html:`<p>You're about to submit your final score of <strong>${U}</strong> points.</p>`,confirmText:"Confirm Submission",cancelText:"Cancel",onConfirm:async()=>{try{await c.Z.patch(`https://rpair.org/api/vex-go/game/${d.id}/coop/`,{score:U,task_times:v},{headers:{Authorization:`Bearer ${I}`}}),f(d.id,{score:U,taskTimes:v,totalTime:e}),m().fire("Success","Score submitted successfully!","success"),s(),_(!1),J(!1),z(!0),O.current&&O.current.send(JSON.stringify({action:"end_game",event_name:t,game_id:q}))}catch(a){console.error("Submission error:",a),m().fire("Error","Failed to submit score","error")}},onCancel:()=>{m().fire("Cancelled","Submission was cancelled","info")}})},className:"px-5 py-3 bg-green-600 hover:bg-green-700 text-white font-bold rounded-lg flex items-center justify-center shadow-md hover:shadow-lg",children:[(0,g.jsx)(n.FJM,{className:"mr-2"})," Submit Score"]}),(0,g.jsxs)("button",{onClick:()=>{const e=new r.default;e.setFontSize(18).setTextColor(79,70,229).text("Ocean Science Exploration",105,20,{align:"center"}).setFontSize(14).text("Coop Match Score Sheet",105,30,{align:"center"}),e.setFontSize(14).setTextColor(0).text(`Match ID: ${(null===d||void 0===d?void 0:d.id)||"N/A"}`,20,40).text(`Teams: ${(null===d||void 0===d?void 0:d.team1_name)||"N/A"} & ${(null===d||void 0===d?void 0:d.team2_name)||"N/A"}`,20,50);const t=p.map(((e,t)=>[e.title,e.points,b[t]||0,H(t)]));e.autoTable({startY:70,head:[["Task","Points","Score","Time"]],body:t,theme:"striped",styles:{fontSize:10},headStyles:{fillColor:[79,70,229],textColor:255}}),e.text(`Total Score: ${U}`,20,e.autoTable.previous.finalY+10),e.save(`Match_${T.matchId}_Score.pdf`)},className:"px-5 py-3 bg-indigo-600 hover:bg-indigo-700 text-white font-bold rounded-lg flex items-center justify-center shadow-md hover:shadow-lg",children:[(0,g.jsx)(n.aBF,{className:"mr-2"})," Download PDF"]})]})]})]})}}}]);
//# sourceMappingURL=5812.5789dde8.chunk.js.map