"use strict";(self.webpackChunkforntend=self.webpackChunkforntend||[]).push([[951],{951:(e,t,s)=>{s.r(t),s.d(t,{default:()=>f});var n=s(2791),i=s(2202),a=s(2602),r=s(5125),o=(s(1052),s(763)),l=s(3859),m=(s(6083),s(2903)),c=s(1830),d=s.n(c),x=s(5804),u=s(6457),h=s(5995),g=s(184);const p=[{title:"Move purple sensor to the fish habitat",points:1},{title:"Move blue sensor to the pipeline",points:1},{title:"Move the orange sensor to the volcano tile",points:1},{title:"Orange sensor placed on top of the volcano",points:2},{title:"Align the turbines",points:"1 per turbine",isDynamic:!0},{title:"Open the clam",points:1},{title:"Remove the pearl from the clam",points:1},{title:"Deliver the pearl to the green starting tile",points:1},{title:"End with the robot on the green tile",points:1}];function f(e){let{eventName:t,onClose:s}=e;const{currentMatch:c,updateMatch:f}=(0,l.a)(),[b,v]=(0,n.useState)({}),[j,N]=(0,n.useState)({}),[y,S]=(0,n.useState)(0),[w,_]=(0,n.useState)(!1),[C,k]=(0,n.useState)(!1),[T,M]=(0,n.useState)(60),[$,O]=(0,n.useState)({matchId:"",team1_name:"",team2_name:""}),[D,E]=((0,a.s0)(),(0,n.useState)([])),F=localStorage.getItem("access_token"),I=(0,n.useRef)(null),[A,J]=(0,n.useState)("disconnected"),[z,P]=((0,n.useRef)(null),(0,n.useState)(!1)),[R,Z]=(0,n.useState)(!1),G=(0,n.useRef)(T),[W]=(0,h.Z)("/sounds/start.mp3",{volume:1}),[B]=(0,h.Z)("/sounds/End.mp3",{volume:1}),[Y]=(0,h.Z)("/sounds/Middle.MP3",{volume:1});(0,n.useEffect)((()=>{"coop"===(null===c||void 0===c?void 0:c.type)&&O({matchId:c.id,team1:c.team1_name,team2:c.team2_name})}),[c]);const q=c.id;(0,n.useEffect)((()=>{if(t&&q)return I.current=new WebSocket(`wss://rpair.org/ws/competition_event/${t}/game/${q}/`),I.current.onopen=()=>{console.log("WebSocket connection established")},I.current.onmessage=e=>{const t=JSON.parse(e.data);"started"===t.status&&(_(!0),P(!1)),t.remaining_time<=0&&(_(!1),P(!0)),"paused"!==t.status?"resume"!==t.status?void 0!==t.remaining_time&&(M(Math.round(t.remaining_time)),t.remaining_time<=0&&(_(!1),P(!0))):k(!1):k(!0)},()=>{I.current&&I.current.close()};u.Z.error({title:"Missing Data",text:"Event name or Game ID is missing. Please check the configuration."})}),[t,q]);const L=e=>{let t=parseInt(e.target.value,10)||0;t>2&&(t=2),t<0&&(t=0),S(t),v((e=>({...e,4:t})));const s=60-T;t>0?(E((e=>e.some((e=>4===e.index))?e:[...e,{index:4,time:s}])),N((e=>({...e,4:s})))):(E((e=>e.filter((e=>4!==e.index)))),N((e=>{const t={...e};return delete t[4],t})))},U=e=>{const t=(0,o.sortBy)(D,"time"),s=t.find((t=>t.index===e));if(!s)return"-";const n=t.indexOf(s);return K(0===n?s.time:s.time-t[n-1].time)},H=Object.values(b).reduce(((e,t)=>e+(parseInt(t)||0)),0),K=e=>{const t=Math.max(0,e),s=t%60;return`${Math.floor(t/60)}:${s<10?"0":""}${s}`};return(0,n.useEffect)((()=>{0===T&&B()}),[T,B]),(0,n.useEffect)((()=>{w&&!C&&G.current>=30&&30===T&&Y(),G.current=T}),[T,w,C,Y]),(0,g.jsxs)("div",{className:"max-w-5xl mx-auto mt-4 sm:mt-8 p-3 sm:p-6 bg-white shadow-md sm:shadow-xl rounded-lg sm:rounded-xl",children:[(0,g.jsxs)("div",{className:"text-center mb-4 sm:mb-8",children:[(0,g.jsx)("h1",{className:"text-xl sm:text-3xl font-bold text-indigo-700 mb-1 sm:mb-2",children:"\ud83c\udf0a Ocean Science Exploration"}),(0,g.jsx)("p",{className:"text-sm sm:text-lg text-gray-600",children:"Coop Match Score Sheet"})]}),(0,g.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2 sm:gap-4 mb-4 sm:mb-6 bg-indigo-50 p-2 sm:p-4 rounded-lg sm:rounded-xl",children:[(0,g.jsxs)("div",{children:[(0,g.jsx)("h3",{className:"text-xs sm:text-sm font-medium text-indigo-700 mb-1",children:"Match ID"}),(0,g.jsx)("p",{className:"text-base sm:text-xl font-bold",children:(null===c||void 0===c?void 0:c.id)||"N/A"})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("h3",{className:"text-xs sm:text-sm font-medium text-indigo-700 mb-1",children:"Team 1"}),(0,g.jsx)("p",{className:"text-base sm:text-xl font-bold",children:(null===c||void 0===c?void 0:c.team1_name)||"N/A"})]}),(0,g.jsxs)("div",{children:[(0,g.jsx)("h3",{className:"text-xs sm:text-sm font-medium text-indigo-700 mb-1",children:"Team 2"}),(0,g.jsx)("p",{className:"text-base sm:text-xl font-bold",children:(null===c||void 0===c?void 0:c.team2_name)||"N/A"})]})]}),(0,g.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-center bg-gray-100 p-2 sm:p-4 rounded-lg mb-4 sm:mb-6",children:[(0,g.jsxs)("div",{className:"flex items-center mb-2 sm:mb-0",children:[(0,g.jsx)(i.qyc,{className:"text-indigo-600 mr-2 text-lg sm:text-xl"}),(0,g.jsx)("span",{className:"text-lg sm:text-xl font-semibold",children:C?"Game Paused":z?"Time's Up!":`${T} seconds`})]}),(0,g.jsxs)("div",{className:"flex gap-1 sm:gap-2 w-full sm:w-auto",children:[!R&&(0,g.jsxs)("button",{onClick:()=>{W(),_(!0),k(!1),Z(!0),P(!1),I.current&&I.current.send(JSON.stringify({action:"start_game",event_name:t,game_id:q}))},disabled:w,className:"flex-1 sm:flex-none px-3 py-1 sm:px-4 sm:py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg flex items-center justify-center text-sm sm:text-base",children:[(0,g.jsx)(i.gmG,{className:"mr-1 sm:mr-2"})," Start"]}),R&&(0,g.jsxs)(g.Fragment,{children:[(0,g.jsxs)("button",{onClick:()=>{w&&!C&&(I.current&&I.current.send(JSON.stringify({action:"pause_game",event_name:t,game_id:q})),k(!0))},disabled:!w||C,className:"flex-1 sm:flex-none px-3 py-1 sm:px-4 sm:py-2 bg-yellow-600 hover:bg-yellow-700 text-white rounded-lg flex items-center justify-center text-sm sm:text-base",children:[(0,g.jsx)(i.Wh,{className:"mr-1 sm:mr-2"}),"Pause"]}),(0,g.jsx)("button",{onClick:()=>{w&&C&&(I.current&&I.current.send(JSON.stringify({action:"resume_game",event_name:t,game_id:q})),k(!1))},disabled:!C,className:"flex-1 sm:flex-none px-3 py-1 sm:px-4 sm:py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg flex items-center justify-center text-sm sm:text-base",children:(0,g.jsx)(x.zPJ,{size:18})}),(0,g.jsxs)("button",{onClick:()=>{u.Z.confirm({title:"Restart Game?",html:"This will reset all counters and the timer!",confirmText:"Confirm Restart",cancelText:"Cancel",onConfirm:()=>{I.current&&I.current.send(JSON.stringify({action:"restart_game",event_name:t,game_id:q})),W(),M(60),_(!1),k(!1),P(!1),v({}),S(0),E([])},onCancel:()=>{d().fire("Cancelled","Game restart was cancelled","info")}})},disabled:!w,className:"flex-1 sm:flex-none px-3 py-1 sm:px-4 sm:py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg flex items-center justify-center text-sm sm:text-base",children:[(0,g.jsx)(i.WLu,{className:"mr-1 sm:mr-2"})," Restart"]})]})]})]}),(0,g.jsx)("table",{className:"w-full border-collapse rounded-lg overflow-hidden shadow-sm sm:shadow-md",children:(0,g.jsx)("tbody",{children:p.map(((e,t)=>(0,g.jsxs)("tr",{className:"border-b "+(t%2===0?"bg-white":"bg-indigo-50"),children:[(0,g.jsx)("td",{className:"px-4 py-2 text-sm",children:e.title}),(0,g.jsx)("td",{className:"px-4 py-2 text-center text-sm font-medium",children:e.points}),(0,g.jsx)("td",{className:"px-4 py-2 text-center text-sm hidden sm:table-cell",children:e.isDynamic?b[4]||0:b[t]||0}),(0,g.jsx)("td",{className:"px-4 py-2 text-center text-sm hidden sm:table-cell",children:U(t)}),(0,g.jsx)("td",{className:"px-4 py-2 text-center",children:e.isDynamic?(0,g.jsx)("input",{type:"number",min:"0",max:"2",value:y,onChange:L,className:"w-16 px-2 py-1 border rounded text-center focus:ring-2 focus:ring-indigo-400 text-sm",disabled:!w||C||z}):(0,g.jsx)("input",{type:"checkbox",checked:!!b[t],onChange:e=>((e,t)=>{const s=60-T;v((s=>({...s,[e]:t?p[e].points:0}))),t?(E((t=>[...t,{index:e,time:s}])),N((t=>({...t,[e]:s})))):(E((t=>t.filter((t=>t.index!==e)))),N((t=>{const s={...t};return delete s[e],s})))})(t,e.target.checked),className:"w-5 h-5 accent-green-500 cursor-pointer",disabled:!w||C||z})})]},t)))})}),(0,g.jsxs)("div",{className:"bg-indigo-50 p-4 rounded-xl mb-6 flex flex-col sm:flex-row justify-between items-center gap-3",children:[(0,g.jsxs)("div",{className:"text-center sm:text-left",children:[(0,g.jsx)("h3",{className:"text-sm font-medium text-indigo-700",children:"Total Score"}),(0,g.jsx)("p",{className:"text-3xl font-bold text-indigo-600",children:H})]}),(0,g.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3 w-full sm:w-auto",children:[(0,g.jsxs)("button",{onClick:async()=>{if(!c)return;const e=60-T;u.Z.confirm({title:"Submit Final Score?",html:`<p>You're about to submit your final score of <strong>${H}</strong> points.</p>`,confirmText:"Confirm Submission",cancelText:"Cancel",onConfirm:async()=>{try{await m.Z.patch(`https://rpair.org/api/vex-go/game/${c.id}/coop/`,{score:H,task_times:j},{headers:{Authorization:`Bearer ${F}`}}),f(c.id,{score:H,taskTimes:j,totalTime:e}),d().fire("Success","Score submitted successfully!","success"),s(),_(!1),Z(!1),P(!0),I.current&&I.current.send(JSON.stringify({action:"end_game",event_name:t,game_id:q}))}catch(n){console.error("Submission error:",n),d().fire("Error","Failed to submit score","error")}},onCancel:()=>{d().fire("Cancelled","Submission was cancelled","info")}})},className:"px-5 py-3 bg-green-600 hover:bg-green-700 text-white font-bold rounded-lg flex items-center justify-center shadow-md hover:shadow-lg",children:[(0,g.jsx)(i.FJM,{className:"mr-2"})," Submit Score"]}),(0,g.jsxs)("button",{onClick:()=>{const e=new r.default;e.setFontSize(18).setTextColor(79,70,229).text("Ocean Science Exploration",105,20,{align:"center"}).setFontSize(14).text("Coop Match Score Sheet",105,30,{align:"center"}),e.setFontSize(14).setTextColor(0).text(`Match ID: ${(null===c||void 0===c?void 0:c.id)||"N/A"}`,20,40).text(`Teams: ${(null===c||void 0===c?void 0:c.team1_name)||"N/A"} & ${(null===c||void 0===c?void 0:c.team2_name)||"N/A"}`,20,50);const t=p.map(((e,t)=>[e.title,e.points,b[t]||0,U(t)]));e.autoTable({startY:70,head:[["Task","Points","Score","Time"]],body:t,theme:"striped",styles:{fontSize:10},headStyles:{fillColor:[79,70,229],textColor:255}}),e.text(`Total Score: ${H}`,20,e.autoTable.previous.finalY+10),e.save(`Match_${$.matchId}_Score.pdf`)},className:"px-5 py-3 bg-indigo-600 hover:bg-indigo-700 text-white font-bold rounded-lg flex items-center justify-center shadow-md hover:shadow-lg",children:[(0,g.jsx)(i.aBF,{className:"mr-2"})," Download PDF"]})]})]})]})}}}]);
//# sourceMappingURL=951.bb2c5176.chunk.js.map