"use strict";(self.webpackChunkforntend=self.webpackChunkforntend||[]).push([[8466],{3791:(e,t,s)=>{s.d(t,{Z:()=>n});var a=s(2791),r=s(2903);const n=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"-id";const[n,l]=(0,a.useState)([]),[i,o]=(0,a.useState)(!0),[c,d]=(0,a.useState)(null),m=localStorage.getItem("access_token"),u=async()=>{try{const a=await r.Z.get(`https://rpair.org/api/core/event/${e}/schedule/`,{params:{ordering:s,stage:t},headers:{Authorization:`Bearer ${m}`}});l(a.data)}catch(a){d(a.message||"Failed to fetch schedules")}finally{o(!1)}};return(0,a.useEffect)((()=>{e&&u()}),[e,s,t]),{schedules:n,loading:i,error:c,refetch:u}}},5442:(e,t,s)=>{s.d(t,{Z:()=>n});var a=s(2791),r=s(2903);const n=e=>{const[t,s]=(0,a.useState)(null),[n,l]=(0,a.useState)(!0),[i,o]=(0,a.useState)(null),c=localStorage.getItem("access_token");return(0,a.useEffect)((()=>{e?(async()=>{try{const t=await r.Z.get(`https://rpair.org/api/core/event/schedule/${e}/`,{headers:{Authorization:`Bearer ${c}`}});s(t.data)}catch(t){o(t.message||"Failed to fetch schedule details")}finally{l(!1)}})():(o("Schedule ID is required"),l(!1))}),[e]),{schedule:t,loading:n,error:i}}},8466:(e,t,s)=>{s.r(t),s.d(t,{default:()=>p});var a=s(2791),r=s(2202),n=s(5804),l=s(6540),i=s(2903),o=s(1830),c=s.n(o),d=s(6457),m=s(5995),u=s(184);const x=e=>{let{onCalculate:t,onClose:s,gameId:o,eventName:x}=e;const[h,g]=(0,a.useState)(0),[b,f]=(0,a.useState)(0),[p,y]=(0,a.useState)(0),[v,j]=(0,a.useState)(60),[N,w]=(0,a.useState)(!1),[S,C]=(0,a.useState)(!1),[k,_]=(0,a.useState)(!1),z=(0,a.useRef)(null),[$,Z]=(0,a.useState)(!1),E=localStorage.getItem("access_token"),T=(0,a.useRef)(v),[M]=(0,m.Z)("/sounds/start.mp3",{volume:1}),[I]=(0,m.Z)("/sounds/End.mp3",{volume:1}),[A]=(0,m.Z)("/sounds/Middle.MP3",{volume:1}),B=(0,a.useMemo)((()=>1*b+1*h+p*(e=>{switch(e){case 4:return 12;case 3:return 10;case 2:return 8;case 1:return 4;default:return 1}})(h)),[h,b,p]);(0,a.useEffect)((()=>{if(x&&o)return z.current=new WebSocket(`wss://rpair.org/ws/competition_event/${x}/game/${o}/`),z.current.onopen=()=>{console.log("WebSocket connection established")},z.current.onmessage=e=>{const t=JSON.parse(e.data);"started"===t.status&&(w(!0),_(!1)),t.remaining_time<=0&&(w(!1),_(!0)),"paused"!==t.status?"resume"!==t.status?void 0!==t.remaining_time&&(j(Math.round(t.remaining_time)),t.remaining_time<=0&&(w(!1),_(!0))):C(!1):C(!0)},z.current.onerror=e=>{console.error("WebSocket error:",e)},()=>{z.current&&z.current.close()};d.Z.error({title:"Missing Data",text:"Event name or Game ID is missing. Please check the configuration."})}),[x,o]);const G=()=>{w(!1),Z(!1),_(!0),z.current&&z.current.send(JSON.stringify({action:"end_game",event_name:x,game_id:o}))};return(0,a.useEffect)((()=>{0===v&&I()}),[v,I]),(0,a.useEffect)((()=>{N&&!S&&(T.current>=25&&25===v||T.current>=35&&35===v)&&A(),T.current=v}),[v,N,S,A]),(0,u.jsx)("div",{className:"fixed inset-0 z-50 bg-black bg-opacity-50 flex items-center justify-center p-4",children:(0,u.jsxs)("div",{className:"bg-white rounded-lg shadow-2xl w-full max-w-md overflow-hidden",children:[(0,u.jsxs)("div",{className:"flex justify-between items-center p-4 border-b border-gray-200",children:[(0,u.jsx)("h2",{className:"text-xl font-bold text-gray-800",children:"Game Score"}),(0,u.jsx)("button",{onClick:s,className:"text-gray-500 hover:text-red-600 transition-colors",children:(0,u.jsx)(r.aHS,{size:24})})]}),(0,u.jsx)("div",{className:"p-4 bg-gray-50",children:(0,u.jsxs)("div",{className:"text-center text-2xl font-bold text-gray-800",children:["Current Score: ",(0,u.jsx)("span",{className:"text-green-600",children:B})]})}),(0,u.jsxs)("div",{className:"p-4",children:[(0,u.jsxs)("div",{className:"flex justify-center space-x-4 mb-4",children:[!$&&(0,u.jsx)("button",{onClick:()=>{M(),w(!0),C(!1),Z(!0),_(!1),z.current&&z.current.send(JSON.stringify({action:"start_game",event_name:x,game_id:o}))},disabled:N,className:"bg-blue-500 text-white p-3 rounded-full shadow-md hover:bg-blue-600 transition-transform transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed",children:(0,u.jsx)(r.gmG,{size:18})}),$&&(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("button",{onClick:()=>{N&&!S&&(z.current&&z.current.send(JSON.stringify({action:"pause_game",event_name:x,game_id:o})),C(!0))},disabled:!N||S,className:"bg-yellow-500 text-white p-3 rounded-full shadow-md hover:bg-yellow-600 transition-transform transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed",children:(0,u.jsx)(r.Wh,{size:18})}),(0,u.jsx)("button",{onClick:()=>{N&&S&&(z.current&&z.current.send(JSON.stringify({action:"resume_game",event_name:x,game_id:o})),C(!1))},disabled:!S,className:"bg-green-500 text-white p-3 rounded-full shadow-md hover:bg-green-600 transition-transform transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed",children:(0,u.jsx)(n.zPJ,{size:18})}),(0,u.jsx)("button",{onClick:()=>{d.Z.confirm({title:"Restart Game?",html:"This will reset all counters and the timer!",confirmText:"Confirm Restart",cancelText:"Cancel",onConfirm:()=>{z.current&&z.current.send(JSON.stringify({action:"restart_game",event_name:x,game_id:o})),M(),j(60),C(!1),_(!1),g(0),f(0),y(0)},onCancel:()=>{c().fire("Cancelled","Game restart was cancelled","info")}})},disabled:!N,className:"bg-red-500 text-white p-3 rounded-full shadow-md hover:bg-red-600 transition-transform transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed",children:(0,u.jsx)(r.lbL,{size:18})})]})]}),(0,u.jsx)("div",{className:"text-center text-lg font-bold text-red-600 bg-gray-100 p-2 rounded-lg shadow-sm",children:S?"Game Paused":k?"Time's Up!":`Remaining Time: ${v} seconds`})]}),(0,u.jsx)("div",{className:"p-4",children:[{label:"Switch",count:h,setCount:g,icon:(0,u.jsx)(r.WLu,{size:20,className:"text-blue-500"}),max:4},{label:"Goal",count:b,setCount:f,icon:(0,u.jsx)(r.ULU,{size:20,className:"text-green-500"})},{label:"Pass",count:p,setCount:y,icon:(0,u.jsx)(l.kSj,{size:20,className:"text-orange-500"})}].map((e=>{let{label:t,count:s,setCount:a,icon:r,max:n}=e;return(0,u.jsxs)("div",{className:"flex items-center justify-between bg-gray-100 p-3 rounded-lg mb-3 shadow-md",children:[(0,u.jsxs)("div",{className:"flex items-center gap-2",children:[r,(0,u.jsx)("span",{className:"font-semibold text-gray-700",children:t})]}),(0,u.jsxs)("div",{className:"flex items-center gap-2",children:[(0,u.jsx)("button",{onClick:()=>a(n?Math.min(n,s+1):s+1),disabled:!N,className:"bg-blue-500 text-white px-3 py-1 rounded-lg hover:bg-blue-600 transition-transform transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed",children:"+"}),(0,u.jsx)("span",{className:"text-xl font-bold",children:s}),(0,u.jsx)("button",{onClick:()=>a(Math.max(0,s-1)),disabled:!N,className:"bg-red-500 text-white px-3 py-1 rounded-lg hover:bg-red-600 transition-transform transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed",children:"-"})]})]},t)}))}),(0,u.jsx)("div",{className:"p-4 border-t border-gray-200",children:(0,u.jsx)("button",{onClick:async()=>{B?d.Z.confirm({title:"Submit Final Score?",html:`<p>You're about to submit your final score of <strong>${B}</strong> points.</p>`,confirmText:"Confirm Submission",cancelText:"Cancel",onConfirm:async()=>{try{const e=await i.Z.post(`https://rpair.org/api/game/${o}/set-game-score/`,{event_name:x,score:B},{headers:{"Content-Type":"application/json",Authorization:`Bearer ${E}`}});if(200!==e.status&&201!==e.status)throw new Error("Failed to submit score");c().fire({icon:"success",title:"Success",text:"Score submitted successfully!",showConfirmButton:!0,confirmButtonColor:"#28a745"}),G(),t(B),s()}catch(e){console.error("Submission error:",e),c().fire("Error","Failed to submit score","error")}},onCancel:()=>{c().fire("Cancelled","Submission was cancelled","info")}}):alert("Please enter a valid score.")},className:"w-full bg-green-500 text-white py-2 rounded-lg text-lg font-semibold shadow-md hover:bg-green-600 transition-transform transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed",children:"Calculate & Submit Score"})})]})})};var h=s(9108),g=s(8408),b=s(3791),f=s(5442);const p=()=>{var e;const{currentCompetition:t}=(0,g.B)(),[s,n]=(0,a.useState)(null),[l,o]=(0,a.useState)({}),[c,d]=(0,a.useState)([]),[m,p]=(0,a.useState)({}),[y,v]=(0,a.useState)(!1),[j,N]=(0,a.useState)([]),w=localStorage.getItem("access_token"),[S,C]=(0,a.useState)(!1),[k,_]=(0,a.useState)(null),z=t,{schedules:$,loading:Z,error:E,refetch:T}=(0,b.Z)(z,"teamwork","-id"),M=null===(e=$[0])||void 0===e?void 0:e.id,{schedule:I,loading:A,error:B,refetch:G}=(0,f.Z)(M);return(0,u.jsxs)("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:[(0,u.jsxs)("div",{className:"mb-8 flex items-center justify-between border-b border-gray-200 pb-6",children:[(0,u.jsxs)("div",{children:[(0,u.jsxs)("h1",{className:"text-3xl font-bold text-indigo-700 flex items-center gap-3",children:[(0,u.jsx)(r.I$,{className:"w-8 h-8"}),"Teamwork Matches"]}),(0,u.jsxs)("p",{className:"mt-2 text-gray-600",children:["Managing matches for ",z]})]}),(0,u.jsxs)("button",{onClick:async()=>{try{await T(),await G()}catch(e){console.error("Error refreshing schedule:",e)}},className:"h-fit flex items-center gap-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg transition-colors",children:[(0,u.jsx)(r.lbL,{className:"w-4 h-4"}),(0,u.jsx)("span",{className:"hidden sm:inline",children:"Refresh Schedule"})]})]}),(0,u.jsxs)("div",{className:"bg-white rounded-xl shadow-lg overflow-hidden mb-8",children:[(0,u.jsxs)("table",{className:"w-full divide-y divide-gray-200",children:[(0,u.jsx)("thead",{className:"bg-indigo-600",children:(0,u.jsx)("tr",{children:["Match","Team 1","Team 2","Score","Actions"].map((e=>(0,u.jsx)("th",{className:"px-4 py-3 text-sm font-semibold text-white text-center uppercase tracking-wider",children:e},e)))})}),(0,u.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:((null===I||void 0===I?void 0:I.games)||[]).map((e=>{var t,s;return(0,u.jsxs)("tr",{className:"hover:bg-gray-50 transition-colors",children:[(0,u.jsxs)("td",{className:"px-4 py-3 text-center font-medium text-indigo-600",children:["#",e.id]}),(0,u.jsx)("td",{className:"px-4 py-3",children:(0,u.jsxs)("div",{className:"flex flex-col space-y-1",children:[(0,u.jsx)("span",{className:"font-medium text-gray-800",children:e.team1_name}),(0,u.jsxs)("span",{className:"text-xs text-gray-500",children:["#",e.team1]})]})}),(0,u.jsx)("td",{className:"px-4 py-3",children:(0,u.jsxs)("div",{className:"flex flex-col space-y-1",children:[(0,u.jsx)("span",{className:"font-medium text-gray-800",children:e.team2_name}),(0,u.jsxs)("span",{className:"text-xs text-gray-500",children:["#",e.team2]})]})}),(0,u.jsx)("td",{className:"px-4 py-3 text-center font-bold text-indigo-600 text-xl",children:null!==(t=null!==(s=m[e.id])&&void 0!==s?s:l[e.id])&&void 0!==t?t:0}),(0,u.jsx)("td",{className:"px-4 py-3 text-center",children:(0,u.jsx)("button",{onClick:()=>{return t=e.id,console.log("matchCode",t),void n(t);var t},className:"p-2 rounded-full bg-indigo-100 hover:bg-indigo-200 text-indigo-600 transition-colors",children:(0,u.jsx)(h.pXb,{className:"w-6 h-6"})})})]},e.id)}))})]}),(Z||A)&&(0,u.jsx)("div",{className:"p-6 space-y-4",children:[...Array(5)].map(((e,t)=>(0,u.jsx)("div",{className:"h-12 bg-gray-100 animate-pulse rounded-lg"},t)))}),E&&(0,u.jsx)("div",{className:"p-6 text-center bg-red-50 border-t-4 border-red-300",children:(0,u.jsxs)("div",{className:"text-red-600 font-medium",children:["\u26a0\ufe0f Error loading schedule: ",E]})})]}),(0,u.jsxs)("div",{className:"bg-white rounded-xl shadow-lg overflow-hidden",children:[(0,u.jsxs)("div",{className:"flex items-center justify-between px-6 py-4 bg-indigo-600",children:[(0,u.jsxs)("h2",{className:"text-xl font-bold text-white flex items-center gap-2",children:[(0,u.jsx)(r.yyP,{className:"w-6 h-6"}),"Team Rankings"]}),(0,u.jsxs)("button",{onClick:()=>{v((e=>{const t=!e;return t&&(async()=>{C(!0),_(null);try{const e=await i.Z.get(`https://rpair.org/api/event/${z}/teamwork-rank/`,{headers:{Authorization:`Bearer ${w}`}});d(e.data)}catch(k){console.error("Error fetching rankings:",k),_(k.message)}finally{C(!1)}})(),t}))},className:"flex items-center gap-2 px-4 py-2 bg-white/10 hover:bg-white/20 text-white rounded-lg transition-colors",children:[(0,u.jsx)(r.NMh,{className:"w-4 h-4"}),y?"Hide":"Show"," Rankings"]})]}),y&&(0,u.jsx)("div",{className:"p-6",children:S?(0,u.jsx)("div",{className:"space-y-4",children:[...Array(5)].map(((e,t)=>(0,u.jsx)("div",{className:"h-12 bg-gray-100 animate-pulse rounded-lg"},t)))}):k?(0,u.jsxs)("div",{className:"text-center py-6 text-red-500",children:["\u26a0\ufe0f Error loading rankings: ",k]}):0===c.length?(0,u.jsx)("div",{className:"text-center py-6 text-gray-500",children:"\ud83c\udfdf\ufe0f No rankings available yet"}):(0,u.jsx)("div",{className:"grid gap-3",children:c.map(((e,t)=>{const s=t+1;return(0,u.jsxs)("div",{className:`flex items-center justify-between p-4 rounded-lg ${s<=3?"border-2":"border hover:border-indigo-200"} ${1===s?"border-yellow-300 bg-yellow-50":2===s?"border-gray-300 bg-gray-50":3===s?"border-amber-400 bg-amber-50":"border-gray-200 bg-white"}`,children:[(0,u.jsxs)("div",{className:"flex items-center gap-4",children:[(0,u.jsx)("span",{className:"w-8 h-8 flex items-center justify-center rounded-full "+(s<=3?1===s?"bg-yellow-400 text-white":2===s?"bg-gray-400 text-white":"bg-amber-500 text-white":"bg-indigo-100 text-indigo-600"),children:s}),(0,u.jsxs)("div",{className:"flex flex-col",children:[(0,u.jsx)("span",{className:"font-medium text-gray-800",children:e.team__name}),(0,u.jsxs)("span",{className:"text-xs text-gray-500",children:["Team #",e.team]})]})]}),(0,u.jsxs)("div",{className:"flex items-center gap-4",children:[(0,u.jsx)("span",{className:"text-lg font-bold text-indigo-600",children:"number"===typeof e.avg_score?e.avg_score.toFixed(2):"N/A"}),s<=3&&(0,u.jsx)("span",{className:"text-sm px-2 py-1 rounded-full "+(1===s?"bg-yellow-100 text-yellow-800":2===s?"bg-gray-100 text-gray-800":"bg-amber-100 text-amber-800"),children:1===s?"Gold":2===s?"Silver":"Bronze"})]})]},e.team)}))})})]}),s&&(0,u.jsx)(x,{onCalculate:e=>{p((t=>({...t,[s]:e}))),n(null)},onClose:()=>n(null),gameId:s,mode:"manual",eventName:z})]})}}}]);
//# sourceMappingURL=8466.bf3f71e9.chunk.js.map