"use strict";(self.webpackChunkforntend=self.webpackChunkforntend||[]).push([[9480],{9480:(e,t,s)=>{s.r(t),s.d(t,{default:()=>g});var a=s(2791),r=s(2202),n=s(9108),l=s(5804),i=s(2903),o=s(1830),c=s.n(o),d=s(6457),m=s(5995),x=s(184);const u=e=>{let{onCalculate:t,onClose:s,mode:n,gameId:o,eventName:u}=e;const[h,g]=(0,a.useState)(0),[b,p]=(0,a.useState)(0),[f,j]=(0,a.useState)(60),[y,N]=(0,a.useState)(!1),[v,w]=(0,a.useState)(!1),[S,C]=(0,a.useState)(!1),k=(0,a.useRef)(null),[_,$]=(0,a.useState)(!1),z=localStorage.getItem("access_token"),T=(0,a.useRef)(f),[G]=(0,m.Z)("/sounds/start.mp3",{volume:1}),[E]=(0,m.Z)("/sounds/End.mp3",{volume:1}),[R]=(0,m.Z)("/sounds/Middle.MP3",{volume:1}),M=(0,a.useMemo)((()=>h*("auto"===n?2:1)+((e,t)=>{let s="auto"===n?6:4;return 4===e?s="auto"===n?18:12:3===e?s="auto"===n?14:10:2===e&&(s="auto"===n?10:8),s*t})(h,b)),[h,b,n]);(0,a.useEffect)((()=>{if(u&&o)return k.current=new WebSocket(`wss://rpair.org/ws/competition_event/${u}/game/${o}/`),k.current.onopen=()=>{console.log("WebSocket connection established")},k.current.onmessage=e=>{const t=JSON.parse(e.data);"started"===t.status&&(N(!0),C(!1)),t.remaining_time<=0&&(N(!1),C(!0)),"paused"!==t.status?"resume"!==t.status?void 0!==t.remaining_time&&(j(Math.round(t.remaining_time)),t.remaining_time<=0&&(N(!1),C(!0))):w(!1):w(!0)},()=>{k.current&&k.current.close()};d.Z.error({title:"Missing Data",text:"Event name or Game ID is missing. Please check the configuration."})}),[u,o]);const P=()=>{N(!1),$(!1),C(!0),k.current&&k.current.send(JSON.stringify({action:"end_game",event_name:u,game_id:o}))};return(0,a.useEffect)((()=>{0===f&&E()}),[f,E]),(0,a.useEffect)((()=>{y&&!v&&(T.current>=25&&25===f||T.current>=35&&35===f)&&R(),T.current=f}),[f,y,v,R]),(0,x.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4",children:(0,x.jsxs)("div",{className:"bg-white rounded-lg shadow-2xl w-full max-w-md overflow-hidden",children:[(0,x.jsxs)("div",{className:"flex justify-between items-center p-4 border-b border-gray-200",children:[(0,x.jsx)("h2",{className:"text-xl font-bold text-gray-800",children:"Game Score"}),(0,x.jsx)("button",{onClick:s,className:"text-gray-500 hover:text-red-600 transition-colors",children:(0,x.jsx)(r.aHS,{size:24})})]}),(0,x.jsx)("div",{className:"p-4 bg-gray-50",children:(0,x.jsxs)("div",{className:"text-center text-2xl font-bold text-gray-800",children:["Current Score: ",(0,x.jsx)("span",{className:"text-green-600",children:M})]})}),(0,x.jsxs)("div",{className:"p-4",children:[(0,x.jsxs)("div",{className:"flex justify-center space-x-4 mb-4",children:[!_&&(0,x.jsx)("button",{onClick:()=>{G(),N(!0),w(!1),$(!0),C(!1),k.current&&k.current.send(JSON.stringify({action:"start_game",event_name:u,game_id:o}))},disabled:y,className:"bg-blue-500 text-white p-3 rounded-full shadow-md hover:bg-blue-600 transition-transform transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed",title:"Start Game",children:(0,x.jsx)(r.gmG,{size:18})}),_&&(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)("button",{onClick:()=>{y&&!v&&(k.current&&k.current.send(JSON.stringify({action:"pause_game",event_name:u,game_id:o})),w(!0))},disabled:!y||v,className:"bg-yellow-500 text-white p-3 rounded-full shadow-md hover:bg-yellow-600 transition-transform transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed",title:"Pause Game",children:(0,x.jsx)(r.Wh,{size:18})}),(0,x.jsx)("button",{onClick:()=>{y&&v&&(k.current&&k.current.send(JSON.stringify({action:"resume_game",event_name:u,game_id:o})),w(!1))},disabled:!v,className:"bg-green-500 text-white p-3 rounded-full shadow-md hover:bg-green-600 transition-transform transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed",title:"Resume Game",children:(0,x.jsx)(l.zPJ,{size:18})}),(0,x.jsx)("button",{onClick:()=>{d.Z.confirm({title:"Restart Game?",html:"This will reset all counters and the timer!",confirmText:"Confirm Restart",cancelText:"Cancel",onConfirm:()=>{k.current&&k.current.send(JSON.stringify({action:"restart_game",event_name:u,game_id:o})),G(),j(60),g(0),p(0),w(!1),C(!1)},onCancel:()=>{c().fire("Cancelled","Game restart was cancelled","info")}})},disabled:!y,className:"bg-red-500 text-white p-3 rounded-full shadow-md hover:bg-red-600 transition-transform transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed",title:"Restart Game",children:(0,x.jsx)(r.lbL,{size:18})})]})]}),(0,x.jsx)("div",{className:"text-center text-lg font-bold text-red-600 bg-gray-100 p-2 rounded-lg shadow-sm",children:v?"Game Paused":S?"Time's Up!":`Remaining Time: ${f} seconds`})]}),(0,x.jsx)("div",{className:"p-4",children:[{label:"Switch",count:h,setCount:g,icon:(0,x.jsx)(r.WLu,{size:20,className:"text-blue-500"})},{label:"Goal",count:b,setCount:p,icon:(0,x.jsx)(r.ULU,{size:20,className:"text-green-500"})}].map((e=>{let{label:t,count:s,setCount:a,icon:r}=e;return(0,x.jsxs)("div",{className:"flex items-center justify-between bg-gray-100 p-3 rounded-lg mb-3 shadow-md",children:[(0,x.jsxs)("div",{className:"flex items-center gap-2",children:[r,(0,x.jsx)("span",{className:"font-semibold text-gray-700",children:t})]}),(0,x.jsxs)("div",{className:"flex items-center gap-2",children:[(0,x.jsx)("button",{onClick:()=>a("Switch"===t?Math.min(4,s+1):s+1),disabled:!y,className:"bg-blue-500 text-white px-3 py-1 rounded-lg hover:bg-blue-600 transition-transform transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed",children:"+"}),(0,x.jsx)("span",{className:"text-lg font-bold",children:s}),(0,x.jsx)("button",{onClick:()=>a(Math.max(0,s-1)),className:"bg-red-500 text-white px-3 py-1 rounded-lg hover:bg-red-600 transition-transform transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed",disabled:!y,children:"-"})]})]},t)}))}),(0,x.jsx)("div",{className:"p-4 border-t border-gray-200",children:(0,x.jsx)("button",{onClick:async()=>{M?d.Z.confirm({title:"Submit Final Score?",html:`<p>You're about to submit your final score of <strong>${M}</strong> points.</p>`,confirmText:"Confirm Submission",cancelText:"Cancel",onConfirm:async()=>{try{const e=await i.Z.post(`https://rpair.org/api/game/${o}/set-game-score/`,{event_name:u,score:M},{headers:{"Content-Type":"application/json",Authorization:`Bearer ${z}`}});if(200!==e.status&&201!==e.status)throw new Error("Failed to submit score");c().fire({icon:"success",title:"Success",text:"Score submitted successfully!",showConfirmButton:!0,confirmButtonColor:"#28a745"}),t(M),s(),P()}catch(e){console.error("Submission error:",e),c().fire("Error","Failed to submit score","error")}},onCancel:()=>{c().fire("Cancelled","Submission was cancelled","info")}}):c().fire("Error","Please enter a valid score.")},className:"w-full bg-green-500 text-white py-2 rounded-lg text-lg font-semibold shadow-md hover:bg-green-600 transition-transform transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed",children:"Calculate & Submit Score"})})]})})};var h=s(8408);const g=()=>{const{currentCompetition:e}=(0,h.B)(),[t,s]=(0,a.useState)({1:!0,2:!1,3:!1}),[l,o]=(0,a.useState)(!1),[c,d]=(0,a.useState)(null),[m,g]=(0,a.useState)({}),[b,p]=(0,a.useState)([]),[f,j]=(0,a.useState)({}),[y,N]=(0,a.useState)(!1),[v,w]=(0,a.useState)(null),[S,C]=(0,a.useState)(1),[k,_]=(0,a.useState)(null),[$,z]=(0,a.useState)(!1),[T,G]=(0,a.useState)([]),[E,R]=(0,a.useState)(""),[M,P]=(0,a.useState)("driver_iq"),Z=e,A=localStorage.getItem("access_token"),B=e=>{let{children:t,className:s}=e;return(0,x.jsx)("th",{className:`px-2.5 py-2 sm:px-4 sm:py-3 text-xs sm:text-sm font-medium text-gray-500 uppercase tracking-wider text-center ${s}`,children:t})},J=e=>{let{children:t,className:s}=e;return(0,x.jsx)("td",{className:`px-2.5 py-2 sm:px-4 sm:py-3 text-sm text-gray-900 text-center ${s}`,children:t})};return(0,x.jsxs)("div",{className:"max-w-6xl mx-auto px-4 py-6",children:[(0,x.jsxs)("div",{className:"text-center mb-8",children:[(0,x.jsx)("h1",{className:"text-3xl font-bold mb-4",children:"\ud83c\udfc6 Skills Challenge"}),(0,x.jsx)("div",{className:"flex justify-center gap-4 mb-6",children:[{id:"driver_iq",label:"Driving Challenge",icon:"\ud83d\ude97",color:"blue"},{id:"auto",label:"Autonomous Challenge",icon:"\ud83e\udd16",color:"blue"}].map((e=>(0,x.jsxs)("button",{onClick:()=>P(e.id),className:"px-6 py-2 rounded-lg flex items-center gap-2 "+(M===e.id?"bg-black text-white":"bg-gray-200"),children:[(0,x.jsx)("span",{className:"text-xl",children:e.icon}),e.label]},e.id)))}),(0,x.jsxs)("form",{onSubmit:async e=>{e.preventDefault();try{const e=await i.Z.post(`https://rpair.org/api/core/event/${Z}/games/schedule/`,{stage:M,game_time:E},{headers:{"Content-Type":"application/json",Authorization:`Bearer ${A}`}});G(e.data),console.log(e.data)}catch(t){console.error("Error posting schedule:",t)}},className:"flex justify-center gap-4 mb-8",children:[(0,x.jsx)("input",{type:"time",value:E,onChange:e=>R(e.target.value),className:"px-4 py-2 border rounded-lg"}),(0,x.jsx)("button",{type:"submit",className:"bg-green-600 text-white px-6 py-2 rounded-lg",children:"View Schedule"})]})]}),(0,x.jsx)("div",{className:"bg-white rounded-xl shadow-lg mb-8",children:(0,x.jsxs)("table",{className:"w-full",children:[(0,x.jsx)("thead",{className:"bg-gray-100",children:(0,x.jsxs)("tr",{children:[(0,x.jsx)("th",{className:"p-4",children:"Match Code"}),(0,x.jsx)("th",{className:"p-4",children:"Team"}),(0,x.jsx)("th",{className:"p-4",children:"driver_iq"===M?"Driver Score":"Auto Score"}),(0,x.jsx)("th",{className:"p-4",children:"Actions"})]})}),(0,x.jsx)("tbody",{children:T.map((e=>{var t,s,a;return(0,x.jsxs)("tr",{className:"border-t",children:[(0,x.jsxs)("td",{className:"p-4 text-center font-extrabold",children:["#",e.id]}),(0,x.jsx)("td",{className:"p-4 text-center",children:(0,x.jsxs)("div",{className:"flex flex-col",children:[(0,x.jsx)("span",{className:"font-medium",children:e.team1_name}),(0,x.jsxs)("span",{className:"text-xs text-gray-500 mt-0.5",children:["#",e.team1]})]})}),(0,x.jsx)("td",{className:"p-4 text-center",children:(null===(t=m[S])||void 0===t||null===(s=t[e.id])||void 0===s?void 0:s["driver_iq"===M?"driver":"auto"])||0}),(0,x.jsx)("td",{className:"p-4 text-center",children:!(null!==(a=f[S])&&void 0!==a&&a[e.id])&&(0,x.jsx)("button",{onClick:()=>((e,t,s)=>{var a;null!==(a=f[t])&&void 0!==a&&a[e.id]||(w(e),C(t),_(s),N(!0),g((a=>{var r,n,l;return{...a,[t]:{...a[t],[e.id]:{...null===(r=a[t])||void 0===r?void 0:r[e.id],[s]:(null===(n=a[t])||void 0===n||null===(l=n[e.id])||void 0===l?void 0:l[s])||0}}}})))})(e,S,"driver_iq"===M?"driver":"auto"),className:"ml-2 text-green-600",children:(0,x.jsx)(n.pXb,{className:"text-2xl "})})})]},e.id)}))})]})}),(0,x.jsx)("div",{className:"flex justify-center mt-4 sm:mt-6 mb-4",children:(0,x.jsxs)("button",{onClick:()=>{z((e=>{const t=!e;return t&&(async()=>{o(!0),d(null);try{const e=await i.Z.get(`https://rpair.org/api/event/${Z}/skills-rank/`,{headers:{Authorization:`Bearer ${A}`}});p(e.data)}catch(c){console.error("Error fetching rankings:",c),d(c.message)}finally{o(!1)}})(),t}))},className:"inline-flex items-center px-4 py-2 text-sm font-medium text-white bg-yellow-500 rounded-lg hover:bg-yellow-600 gap-2",children:[(0,x.jsx)(r.yyP,{className:"shrink-0"}),(0,x.jsx)("span",{className:"hidden sm:inline",children:"View Ranking"}),(0,x.jsx)("span",{className:"sm:hidden",children:"Ranking"})]})}),$&&(0,x.jsxs)("div",{className:"overflow-x-auto shadow-lg rounded-xl mt-4 bg-white p-4 border border-gray-200",children:[(0,x.jsxs)("h2",{className:"text-xl sm:text-2xl font-bold text-center text-gray-800 mb-4 flex items-center justify-center gap-2",children:[(0,x.jsx)(r.yyP,{className:"text-yellow-500"}),"Team Rankings",(0,x.jsx)(r.yyP,{className:"text-yellow-500"})]}),l?(0,x.jsxs)("div",{className:"text-center py-8",children:[(0,x.jsxs)("svg",{className:"animate-spin h-8 w-8 text-blue-500 mx-auto",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,x.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,x.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),(0,x.jsx)("p",{className:"mt-3 text-gray-600",children:"Loading rankings..."})]}):c?(0,x.jsxs)("div",{className:"text-center py-4 text-red-500",children:["\u26a0\ufe0f Error loading rankings: ",c]}):0===b.length?(0,x.jsx)("div",{className:"text-center py-4 text-gray-500",children:"\ud83c\udfdf\ufe0f No rankings available yet"}):(0,x.jsxs)("table",{className:"w-full border-collapse","aria-label":"Team rankings",children:[(0,x.jsx)("thead",{children:(0,x.jsxs)("tr",{className:"bg-gray-50",children:[(0,x.jsx)(B,{className:"text-center w-20",children:"Rank"}),(0,x.jsx)(B,{className:"text-left",children:"Team"}),(0,x.jsx)(B,{className:"text-right pr-6",children:"Total Score"})]})}),(0,x.jsx)("tbody",{children:b.map(((e,t)=>{const s=t+1;return(0,x.jsxs)("tr",{className:`transition-all duration-150 ${s<=3?"bg-gradient-to-r":"hover:bg-gray-50"} ${1===s?"from-yellow-50/50 to-yellow-50":2===s?"from-gray-50/50 to-gray-50":3===s?"from-amber-50/50 to-amber-50":""}`,children:[(0,x.jsx)(J,{className:"text-center font-semibold",children:(0,x.jsx)("div",{className:"flex items-center justify-center",children:s<=3?(0,x.jsx)("span",{className:` w-6 h-6 rounded-full flex items-center justify-center \n                        ${1===s?"bg-yellow-400":2===s?"bg-gray-400":"bg-amber-600"} text-white`,children:s}):(0,x.jsx)("span",{className:"text-gray-600",children:s})})}),(0,x.jsx)(J,{className:"text-left",children:(0,x.jsxs)("div",{className:"flex items-center justify-center ",children:[(0,x.jsx)("span",{className:" w-8 h-8 rounded-lg bg-blue-50 flex items-center justify-center mr-2 ",children:(0,x.jsxs)("span",{className:"text-blue-600 font-medium",children:["#",e.team]})}),(0,x.jsx)("span",{className:"font-medium text-gray-800",children:e.team__name})]})}),(0,x.jsx)(J,{className:"text-right pr-6",children:(0,x.jsxs)("div",{className:"flex items-center justify-end ",children:[(0,x.jsx)("span",{className:"font-semibold text-blue-600",children:"number"===typeof e.total_score?e.total_score.toFixed(2):"N/A"}),s<=3&&(0,x.jsx)("span",{className:"text-sm px-2 py-1 rounded-full \n                        "+(1===s?"bg-yellow-100 text-yellow-800":2===s?"bg-gray-100 text-gray-800":"bg-amber-100 text-amber-800"),children:1===s?"Gold":2===s?"Silver":"Bronze"})]})})]},e.team)}))})]})]}),y&&v&&(0,x.jsx)(u,{onCalculate:e=>{v&&S&&k&&(g((t=>{var s;return{...t,[S]:{...t[S],[v.id]:{...null===(s=t[S])||void 0===s?void 0:s[v.id],[k]:e||0}}}})),N(!1))},onClose:()=>N(!1),mode:M,gameId:v.id,eventName:Z})]})}}}]);
//# sourceMappingURL=9480.3849216e.chunk.js.map